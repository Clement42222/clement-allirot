{% extends '@!EasyAdmin/layout.html.twig' %}

{% block main %}

	<h2>Agir sur la commande</h2>
	{% if order.state != 1 %}
		<a href="{{currentUrl}}&state=3" {% if order.state == 3%}style="display:none;"{% endif %} class="btn btn-warning">Commande en cours de préparation</a>
		<a href="{{currentUrl}}&state=4" {% if order.state == 4%}style="display:none;"{% endif %} class="{% if order.state == 4%}display:none;{% endif %}btn btn-success">Commande expédiée</a>
		<a href="{{currentUrl}}&state=5" {% if order.state == 5%}style="display:none;"{% endif %} class="{% if order.state == 5%}display:none;{% endif %}btn btn-danger">Commande annulée</a>
	{% else %}
		Vous ne pouvez pas agir sur une commande impayée.
	{% endif %}

	<hr>
	<small>
		<a href="{{ path('app_invoice_admin', {id_order: order.id}) }}" target="_blank" class="btn btn-light btn-sm">Voir/Imprimer la facture</a>
	</small>
	<h3 class="mt-2">Commande n°
		{{ order.id }}</h3>
	{{ include ('admin/state.html.twig', {
        field: 
            {
                'value': order.state
            }
        }
    ) }}

	<br>
	<br>

	<span>Passée le :
		{{ order.createdAt | date('d/m/Y') }}</span>
	<br>

	<span>Stripe Session Id :
		{{ order.stripeSessionId }}</span>

	<div class="row mt-4 mb-4">
		<div class="col-md-6">
			<strong>Adresse de livraison</strong><br/>
			{{ order.delivery | raw }}
		</div>
		<div class="col-md-6">
			<strong>Transporteur</strong><br/>
			{{ order.carrierName | raw }}
		</div>
	</div>

	<strong>Contenu de la commande :</strong>
	<br>

	<table class="table">
		<thead>
			<tr>
				<th scope="col">Illustration</th>
				<th scope="col">Nom du produit</th>
				<th scope="col">Quantité</th>
				<th scope="col">Prix unitaire H.T</th>
				<th scope="col">TVA</th>
				<th scope="col">Total T.T.C</th>
			</tr>
		</thead>
		<tbody>
			{% for product in order.orderDetails %}
				<tr>
					<td><img class="" width="100px" src="uploads/{{ product.productIllustration }}" alt="{{ product.productIllustration }}"/></td>
					<td>{{ product.productName }}</td>
					<td>{{ product.productQuantity }}</td>
					<td>{{ product.productPrice | price }}</td>
					<td>{{ product.productTva }}
						%</td>

					{% set coeff = 1 + (product.productTva / 100) %}
					<td>{{ ((product.productPrice * coeff) * product.productQuantity) | price  }}</td>
				</tr>
			{% endfor %}
			<tr>
				<td></td>
				<td>{{ order.carrierName }}</td>
				<td>1</td>
				<td></td>
				<td></td>
				<td>{{ order.carrierPrice | price  }}</td>
			</tr>
		</tbody>
	</table>

	<div class="text-right fs-5">
		<strong>Total H.T:
		</strong>
		{{ order.totalHt | price }}
		<br>
		<strong>Total T.V.A :
		</strong>
		{{ order.totalTva }}
		<br>
		<strong>Total T.T.C :
		</strong>
		{{ order.totalWt }}
	</div>
{% endblock %}
